@model UsuarioModel;

<style>
    .form-floating > .form-control:focus ~ label::after,
    .form-floating > .form-control:not(:placeholder-shown) ~ label::after,
    .form-floating > .form-control-plaintext ~ label::after,
    .form-floating > .form-select ~ label::after {
        background-color: transparent !important;
        color: black;
    }

    .google-material {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px;
        background: white;
        border: 1px solid #ccc;
        border-radius: 25px;
        cursor: pointer;
        font-size: 15px;
        font-weight: 500;
        transition: 0.2s;
        width: fit-content;
    }

        .google-material img {
            width: 24px;
            height: 24px;
        }

        .google-material:hover {
            background: #f5f5f5;
        }
</style>

<div class="row mb-2">
    <h2 class="text-uppercase">
        Cadastre-se
    </h2>
</div>

<hr />

<form method="post" id="form-cadastro">
    <input type="hidden" asp-for="ID" />
    <input type="hidden" asp-for="GoogleId" />

    <div class="row mb-3">
        <div class="col">
            <div class="form-floating">
                <input type="email" class="form-control" id="floatingEmail" asp-for="Email" placeholder=" ">
                <label for="floatingEmail">Email</label>
            </div>
        </div>
        <div class="col">
            <div class="form-floating">
                <input type="text" class="form-control" id="floatingUsuario" asp-for="Usuario" placeholder=" ">
                <label for="floatingUsuario">Usuario</label>
            </div>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col">
            <div class="form-floating">
                <input type="text" class="form-control" id="floatingNome" asp-for="NomeCompleto" placeholder=" ">
                <label for="floatingNome">Nome Completo</label>
            </div>
        </div>
        <div class="col">
            <select asp-for="Genero" class="form-select py-3">
                <option disabled selected>GENERO</option>
                <option value="M">Masculino</option>
                <option value="F">Feminino</option>
                <option value="O">Outro</option>
            </select>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-auto">
            <button type="button" id="btnSalvar" class="btn btn-success btn-sm">
                <span id="texto-salvar">
                    <i class="fa-regular fa-floppy-disk"></i>&nbsp;
                    Salvar
                </span>
                <span id="loading" style="display:none; text-align:center;" class="spinner-border spinner-border-sm" role="status"></span>
            </button>
        </div>
        <div class="col-auto">
            <a asp-controller="Home" asp-action="Login" class="btn btn-secondary btn-sm">Voltar</a>
        </div>
    </div>
</form>


<div class="row justify-content-center mb-3">
    <a asp-action="LoginGoogle" asp-controller="GoogleLogin" class="google-material">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">
    </a>
</div>


@section Scripts {
    <script>
        //TODO: adicionar loading

        $('#btnSalvar').on('click', function () {
            $.ajax({
                url: '/Home/Cadastro',
                type: 'POST',
                data: $('#form-cadastro').serialize(),
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                beforeSend: function () {
                    $('#btnSalvar').prop('disabled', true);
                },
                complete: function () {
                    $('#btnSalvar').prop('disabled', false);
                }
            })
            .done(function (response) {
                if (response.success) {
                    window.location.href = response.redirectUrl;
                }
            })
            .fail(function (xhr) {
                if (xhr.responseJSON) {
                    Swal.fire({
                        icon: 'error',
                        title: xhr.responseJSON.title ?? 'Erro',
                        html: xhr.responseJSON.detail
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro',
                        text: 'Erro inesperado ao processar a requisição.'
                    });
                }
            });
        });


    </script>
}
